<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>(Day 17) - Advent of Cyber</title>
    <link href="/static-site-generator/index.css" rel="stylesheet" />
  </head>

  <body>
    <article><div><h1>(Day 17) - Advent of Cyber</h1><h2>Splunk SIEM</h2><p>Upon viewing the application we first see the following screen:</p><p><img src="/static-site-generator/images/Pasted image 20241230005229.png" alt="Pasted image 20241230005229.png"></img></p><p>We will head towards search and reporting tab and show all logs by filtering by <code>index=*</code> for logs from all time.</p><p><img src="/static-site-generator/images/Pasted image 20241230005659.png" alt="Pasted image 20241230005659.png"></img></p><p>There we see that there are over 10,000 events that we will need to sort through, to narrow down the logs, by looking at the sourcetype field, we see that there are two datasets that the logs come from. They are web<i>logs and cctv</i>logs, considering that the main issue was about cctv<i>logs we will filter the logs for just the cctv</i>logs.</p><p><img src="/static-site-generator/images/Pasted image 20241230010507.png" alt="Pasted image 20241230010507.png"></img></p><h4>Field Extraction</h4><p>To get the fields and be able to sort them and look for commonalities, we will have to extract the fields, although some of the fields end up being in a different format, we will extract the fields simply and fix it later. To do this we will make use of a regex.</p><p><img src="/static-site-generator/images/Pasted image 20241230011447.png" alt="Pasted image 20241230011447.png"></img></p><p><img src="/static-site-generator/images/Pasted image 20241230011550.png" alt="Pasted image 20241230011550.png"></img></p><p><img src="/static-site-generator/images/Pasted image 20241230011715.png" alt="Pasted image 20241230011715.png"></img></p><p>However, we see that some fields do not work with this regex:</p><p><img src="/static-site-generator/images/Pasted image 20241230011742.png" alt="Pasted image 20241230011742.png"></img></p><p>We will now save the logs:</p><p><img src="/static-site-generator/images/Pasted image 20241230011947.png" alt="Pasted image 20241230011947.png"></img></p><p>Then we will click <code>Explore the fields I just created in Search</code> by which we can now see, organize and sort logs by individual and common fields, e.g.:</p><p><img src="/static-site-generator/images/Pasted image 20241230012318.png" alt="Pasted image 20241230012318.png"></img></p><p>However, due to the fact that some logs are incorrectly represented, we will need to remove the field extraction and replace it with a new one so that specific logs that are interesting or have helpful details are not filtered out. So to delete the field extraction we will do the following:</p><ol><li>Head to Settings > fields.</li><li>Field Extractions</li><li>Filter by "cctv".</li><li>Delete the regex.</li></ol><p>Now we will update the regex by clicking Open Field Extractor:</p><p><img src="/static-site-generator/images/Pasted image 20241230014231.png" alt="Pasted image 20241230014231.png"></img></p><p>Now after selecting the above we will click <code>I prefer to write the regular expression myself</code>. We will then input the following regex:</p><pre><code>^(?P<timestamp>\d+\-\d+\-\d+\s+\d+:\d+:\d+)\s+(?P<Event>(Login\s\w+|\w+))\s+(?P<user_id>\d+)?\s?(?P<UserName>\w+)\s+.*?(?P<Session_id>\w+)$
</code></pre><p>Then we will click save, then finish, then click <code>Explore the fields I just created in search</code>.</p><p><img src="/static-site-generator/images/Pasted image 20241230015549.png" alt="Pasted image 20241230015549.png"></img></p><h4>CCTV Events Analysis</h4><p>We will filter the events using the following query:</p><pre><code>index=cctv_feed | stats count(Event) by UserName
</code></pre><p>From this filter, we receive the following output:</p><p><img src="/static-site-generator/images/Pasted image 20241230020235.png" alt="Pasted image 20241230020235.png"></img></p><pre><code>index=cctv_feed | stats count by Event
</code></pre><p><img src="/static-site-generator/images/Pasted image 20241230020331.png" alt="Pasted image 20241230020331.png"></img></p><p>Now we will take a look at rare events:</p><pre><code>index=cctv_feed | rare Event
</code></pre><p><img src="/static-site-generator/images/Pasted image 20241230020554.png" alt="Pasted image 20241230020554.png"></img></p><p>It seems that there are quite a few failed login attempts, we will now filter the logs to see who was failing this login attempts.</p><pre><code>index=cctv_feed *failed* | table _time UserName Event Session_id
</code></pre><p><img src="/static-site-generator/images/Pasted image 20241230020934.png" alt="Pasted image 20241230020934.png"></img></p><p>There we see that there are failed login attempts to many accounts using the same session id. So we can see that whoever is using this session id is likely to be the infiltrator so now we shall search for that specific session id to find out more information about the attacker. We will do this using the following filter:</p><pre><code>index=cctv_feed *rij5uu4gt204q0d3eb7jj86okt* | table _time UserName Event Session_id
</code></pre><p>There we are able to see exactly what the suspected user did in relation to the application. Now we can try and see how many of these deletion events occurred using the following:</p><pre><code>`index=cctv_feed *Delete*`
</code></pre><p>Here we see that we have 2 cctv deletion requests by that same session/user:</p><p><img src="/static-site-generator/images/Pasted image 20241230023756.png" alt="Pasted image 20241230023756.png"></img></p><p>Now what we can do is correlate what the user with that same session token did on the web application using the following filter:</p><pre><code>index=web_logs *rij5uu4gt204q0d3eb7jj86okt*
</code></pre><p>Using this filter we see 41 related web logs:</p><p><img src="/static-site-generator/images/Pasted image 20241230024046.png" alt="Pasted image 20241230024046.png"></img></p><p>Looking at the clientip field we can see that all of the logs come from one IP address:</p><p><img src="/static-site-generator/images/Pasted image 20241230024146.png" alt="Pasted image 20241230024146.png"></img></p><p>Now filtering the web logs for that specific IP address, we are able to see that there are more than just one session id used:</p><pre><code>index=web_logs clientip="10.11.105.33" | table _time clientip status uri ur_path file
</code></pre><p>Looking at the status of the following commands, we see:</p><p><img src="/static-site-generator/images/Pasted image 20241230024753.png" alt="Pasted image 20241230024753.png"></img></p><p>Looking at the first session id, it looks like that id had done a lot of things, so if we were to search for this session id in the cctv logs we should be able to see interesting things, we can do this by filtering using:</p><pre><code>index=cctv_feed *lsr1743nkskt3r722momvhjcs3*
</code></pre><p>From this filter we are able to identify the username of the attacker:</p><p><img src="/static-site-generator/images/Pasted image 20241230025657.png" alt="Pasted image 20241230025657.png"></img></p><p><b>mmalware</b></p></div></article>
    <a href="/">Back to Home</a>
  </body>
  <hr>
  <footer>
    Made By Rishan
  </footer>
</html>